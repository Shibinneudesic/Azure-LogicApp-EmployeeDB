# Steps 3 & 4: Manual Configuration Guide
# Complete these steps in Azure Portal or ask your admin

## STEP 3: Create Azure Queue Connection

### Option A: Via Azure Portal (Recommended)
1. Go to Azure Portal: https://portal.azure.com
2. Navigate to: **ais-training-la** Logic App
3. Left menu ‚Üí **Workflows** ‚Üí Click **Connections**
4. Click **+ Add** (or **+ JSON View**)
5. Search for **"Azure Queues"**
6. Configure connection:
   - **Connection Name**: `azurequeues`
   - **Authentication**: Select **Managed Identity**
   - **Storage Account**: `aistrainingshibinbf12`
7. Click **Create**

### Option B: Via Azure CLI (if you have permissions)
```powershell
# This requires Microsoft.Web/connections write permissions
az deployment group create `
  --resource-group AIS_Training_Shibin `
  --template-file queue-connection-template.json
```

---

## STEP 4: Grant Managed Identity Permissions

**You need Azure RBAC permissions or ask your admin to run these commands:**

### Required Information:
- **Service Principal Name**: ais-training-la
- **Principal ID**: `99ded633-38c2-4f05-a41c-7ba48aed3285`
- **Subscription**: `cbb1dbec-731f-4479-a084-bdaec5e54fd4`
- **Resource Group**: `AIS_Training_Shibin`

### A. Grant Service Bus Permissions
```powershell
az role assignment create `
  --assignee 99ded633-38c2-4f05-a41c-7ba48aed3285 `
  --role "Azure Service Bus Data Owner" `
  --scope "/subscriptions/cbb1dbec-731f-4479-a084-bdaec5e54fd4/resourceGroups/AIS_Training_Shibin/providers/Microsoft.ServiceBus/namespaces/sb-flatfile-processing"
```

**Via Azure Portal:**
1. Go to Service Bus namespace: **sb-flatfile-processing**
2. Left menu ‚Üí **Access control (IAM)**
3. Click **+ Add** ‚Üí **Add role assignment**
4. Role: **Azure Service Bus Data Owner**
5. Assign access to: **Managed Identity**
6. Select: **ais-training-la**
7. Click **Save**

### B. Grant Storage Queue Permissions
```powershell
az role assignment create `
  --assignee 99ded633-38c2-4f05-a41c-7ba48aed3285 `
  --role "Storage Queue Data Contributor" `
  --scope "/subscriptions/cbb1dbec-731f-4479-a084-bdaec5e54fd4/resourceGroups/AIS_Training_Shibin/providers/Microsoft.Storage/storageAccounts/aistrainingshibinbf12"
```

**Via Azure Portal:**
1. Go to Storage Account: **aistrainingshibinbf12**
2. Left menu ‚Üí **Access control (IAM)**
3. Click **+ Add** ‚Üí **Add role assignment**
4. Role: **Storage Queue Data Contributor**
5. Assign access to: **Managed Identity**
6. Select: **ais-training-la**
7. Click **Save**

---

## Verification Steps

After completing Steps 3 & 4:

### 1. Verify Connections
```powershell
az resource list --resource-group AIS_Training_Shibin --resource-type "Microsoft.Web/connections" --output table
```
Should show: `azurequeues` connection

### 2. Verify Role Assignments
```powershell
# Check Service Bus permissions
az role assignment list --assignee 99ded633-38c2-4f05-a41c-7ba48aed3285 --scope "/subscriptions/cbb1dbec-731f-4479-a084-bdaec5e54fd4/resourceGroups/AIS_Training_Shibin/providers/Microsoft.ServiceBus/namespaces/sb-flatfile-processing" --output table

# Check Storage permissions
az role assignment list --assignee 99ded633-38c2-4f05-a41c-7ba48aed3285 --scope "/subscriptions/cbb1dbec-731f-4479-a084-bdaec5e54fd4/resourceGroups/AIS_Training_Shibin/providers/Microsoft.Storage/storageAccounts/aistrainingshibinbf12" --output table
```

### 3. Test the Workflows
Once permissions are granted:
1. Place a CSV file in `C:\EmployeeFiles`
2. Check Logic App run history for **wf-flatfile-pickup**
3. Verify message in Service Bus queue
4. Check **wf-flatfile-transformation** workflow runs
5. Verify messages in storage queues: `flatfile-xml-queue` and `flatfile-json-queue`

---

## Summary

‚úÖ **Completed**:
- Logic App settings configured
- Workflows deployed to Azure
- Gateway resource created and configured

‚è≥ **Pending** (Need admin permissions):
- Create Azure Queue connection
- Grant Service Bus Data Owner role
- Grant Storage Queue Data Contributor role

üìß **Send this information to your admin** to complete the setup.
